<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>GradePay ‚Äî –£–º–Ω—ã–π –¥–Ω–µ–≤–Ω–∏–∫ –æ—Ü–µ–Ω–æ–∫ üìö</title>
<meta name="theme-color" content="#1e293b"/>

<!-- üîπ –§–ê–í–ò–ö–û–ù -->
<link rel="icon" type="image/png" sizes="32x32" href="https://i.ibb.co/chQzx6c1/images.png">
<link rel="shortcut icon" href="https://i.ibb.co/chQzx6c1/images.png">

<style>
/* ============================= –ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–ê–Ø –¢–ï–ú–ù–ê–Ø –¢–ï–ú–ê ============================= */
:root{
  /* –û—Å–Ω–æ–≤–Ω–∞—è –ø–∞–ª–∏—Ç—Ä–∞ */
  --primary: #6366f1;
  --primary-light: #818cf8;
  --primary-dark: #4f46e5;
  --secondary: #8b5cf6;
  --accent: #06b6d4;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
  --info: #3b82f6;
  
  /* –¢–µ–º–Ω–∞—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ */
  --bg-primary: #0f172a;
  --bg-secondary: #1e293b;
  --bg-tertiary: #334155;
  --bg-card: #1e293b;
  --bg-glass: rgba(30, 41, 59, 0.8);
  --bg-glass-hover: rgba(51, 65, 85, 0.9);
  
  /* –¢–µ–∫—Å—Ç */
  --text-primary: #f8fafc;
  --text-secondary: #cbd5e1;
  --text-muted: #94a3b8;
  --text-accent: #e2e8f0;
  
  /* –ì—Ä–∞–Ω–∏—Ü—ã –∏ —Ç–µ–Ω–∏ */
  --border: #334155;
  --border-light: #475569;
  --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
  --shadow-md: 0 8px 25px rgba(0, 0, 0, 0.4);
  --shadow-lg: 0 15px 35px rgba(0, 0, 0, 0.5);
  --shadow-glow: 0 0 30px rgba(99, 102, 241, 0.4);
  --shadow-xl: 0 25px 50px rgba(0, 0, 0, 0.6);
  
  /* –°–∫—Ä—É–≥–ª–µ–Ω–∏—è */
  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 16px;
  --radius-xl: 20px;
}

/* ============================= –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò ============================= */
* {
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

html, body {
  height: 100%;
  margin: 0;
  padding: 0;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Inter", "Helvetica Neue", Arial, sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  font-size: 16px;
  line-height: 1.6;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* ============================= –†–ê–°–®–ò–†–ï–ù–ù–´–ï –ê–ù–ò–ú–ê–¶–ò–ò ============================= */
@keyframes slideInUp {
  from { opacity: 0; transform: translateY(40px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes slideInLeft {
  from { opacity: 0; transform: translateX(-40px); }
  to { opacity: 1; transform: translateX(0); }
}

@keyframes slideInRight {
  from { opacity: 0; transform: translateX(40px); }
  to { opacity: 1; transform: translateX(0); }
}

@keyframes fadeInScale {
  from { opacity: 0; transform: scale(0.8); }
  to { opacity: 1; transform: scale(1); }
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

@keyframes bounce {
  0%, 20%, 53%, 80%, 100% { transform: translateY(0); }
  40%, 43% { transform: translateY(-12px); }
  70% { transform: translateY(-6px); }
  90% { transform: translateY(-3px); }
}

@keyframes shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

@keyframes float {
  0%, 100% { transform: translateY(0px) rotate(0deg); }
  25% { transform: translateY(-4px) rotate(1deg); }
  50% { transform: translateY(-2px) rotate(0deg); }
  75% { transform: translateY(-6px) rotate(-1deg); }
}

@keyframes glow {
  0%, 100% { box-shadow: var(--shadow-md); }
  50% { box-shadow: var(--shadow-glow); }
}

@keyframes sparkle {
  0%, 100% { opacity: 1; transform: scale(1) rotate(0deg); }
  50% { opacity: 0.7; transform: scale(1.2) rotate(180deg); }
}

@keyframes slideInStagger {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes countUp {
  from { transform: scale(0.5); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

@keyframes progressFill {
  from { width: 0; }
  to { width: var(--target-width); }
}

/* ============================= –ö–û–ù–¢–ï–ô–ù–ï–† ============================= */
.app {
  max-width: 1400px;
  margin: 0 auto;
  padding: 20px;
  min-height: 100vh;
  animation: slideInUp 0.8s ease;
}

@media (max-width: 768px) {
  .app { padding: 10px; }
}

/* ============================= –ì–õ–ê–í–ù–û–ï –û–ö–ù–û ============================= */
.win {
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-xl);
  overflow: hidden;
  min-height: calc(100vh - 40px);
  display: flex;
  flex-direction: column;
  animation: fadeInScale 0.6s ease;
}

@media (max-width: 768px) {
  .win { 
    min-height: calc(100vh - 20px); 
    border-radius: var(--radius-lg);
  }
}

/* ============================= –ó–ê–ì–û–õ–û–í–û–ö ============================= */
.title {
  background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
  color: var(--text-primary);
  padding: 24px 28px;
  font-weight: 700;
  font-size: 24px;
  display: flex;
  align-items: center;
  gap: 16px;
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: var(--shadow-md);
}

.title::before {
  content: 'üìö';
  font-size: 28px;
  animation: float 4s ease-in-out infinite;
}

@media (max-width: 768px) {
  .title {
    padding: 20px 24px;
    font-size: 20px;
  }
}

/* ============================= –ö–ù–û–ü–ö–ò ============================= */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 12px 20px;
  background: var(--bg-card);
  color: var(--text-primary);
  border: 2px solid var(--border);
  border-radius: var(--radius-md);
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  user-select: none;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  text-decoration: none;
  min-height: 48px;
  position: relative;
  overflow: hidden;
}

.btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
  transition: left 0.6s ease;
}

.btn:hover {
  background: var(--bg-tertiary);
  border-color: var(--primary);
  transform: translateY(-3px) scale(1.02);
  box-shadow: var(--shadow-lg);
  color: var(--primary);
}

.btn:hover::before {
  left: 100%;
}

.btn:active {
  transform: translateY(-1px) scale(0.98);
  animation: pulse 0.3s ease;
}

.btn.primary {
  background: linear-gradient(135deg, var(--primary), var(--primary-light));
  color: var(--text-primary);
  border-color: var(--primary);
}

.btn.primary:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: var(--shadow-glow);
}

.btn.success {
  background: linear-gradient(135deg, var(--success), #059669);
  color: var(--text-primary);
  border-color: var(--success);
}

.btn.warning {
  background: linear-gradient(135deg, var(--warning), #d97706);
  color: var(--text-primary);
  border-color: var(--warning);
}

.btn.danger {
  background: linear-gradient(135deg, var(--danger), #dc2626);
  color: var(--text-primary);
  border-color: var(--danger);
}

@media (max-width: 768px) {
  .btn {
    padding: 14px 20px;
    font-size: 16px;
    min-height: 52px;
  }
}

/* ============================= –ü–û–õ–Ø –í–í–û–î–ê ============================= */
input[type="text"],
input[type="number"],
input[type="week"],
select {
  background: var(--bg-card);
  border: 2px solid var(--border);
  border-radius: var(--radius-md);
  padding: 12px 16px;
  font-size: 16px;
  color: var(--text-primary);
  transition: all 0.4s ease;
  min-height: 48px;
  min-width: 140px;
}

input:focus,
select:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
  transform: scale(1.02);
  background: var(--bg-tertiary);
}

@media (max-width: 768px) {
  input[type="text"],
  input[type="number"],
  input[type="week"],
  select {
    min-height: 52px;
    font-size: 16px;
  }
}

/* ============================= –ë–ï–ô–î–ñ–ò ============================= */
.badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  background: var(--bg-tertiary);
  color: var(--text-secondary);
  border-radius: var(--radius-lg);
  font-size: 13px;
  font-weight: 500;
  border: 1px solid var(--border);
  transition: all 0.3s ease;
  animation: slideInStagger 0.6s ease;
}

.badge:hover {
  background: var(--bg-glass-hover);
  transform: translateY(-2px);
  color: var(--text-primary);
  box-shadow: var(--shadow-sm);
}

.badge.success { 
  background: linear-gradient(135deg, var(--success), #059669);
  color: var(--text-primary);
  border-color: var(--success);
  animation: glow 3s ease-in-out infinite alternate;
}

.badge.warning { 
  background: linear-gradient(135deg, var(--warning), #d97706);
  color: var(--text-primary);
  border-color: var(--warning);
}

.badge.info { 
  background: linear-gradient(135deg, var(--info), #2563eb);
  color: var(--text-primary);
  border-color: var(--info);
}

@media (max-width: 768px) {
  .badge {
    padding: 10px 16px;
    font-size: 14px;
  }
}

/* ============================= –£–¢–ò–õ–ò–¢–´ ============================= */
.row {
  display: flex;
  align-items: center;
  gap: 16px;
  flex-wrap: wrap;
}

@media (max-width: 768px) {
  .row { gap: 12px; }
}

h3 {
  margin: 0 0 24px;
  font-size: 32px;
  font-weight: 700;
  color: var(--text-primary);
  position: relative;
  padding-left: 48px;
  animation: slideInLeft 0.8s ease;
}

h3::before {
  content: '‚ú®';
  position: absolute;
  left: 0;
  top: 0;
  font-size: 32px;
  animation: sparkle 3s ease-in-out infinite;
}

.sep {
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--border), transparent);
  margin: 28px 0;
}

/* ============================= –ú–ê–ö–ï–¢ ============================= */
.layout {
  display: flex;
  flex: 1;
  min-height: 0;
}

@media (max-width: 768px) {
  .layout {
    flex-direction: column;
  }
}

/* ============================= –ù–ê–í–ò–ì–ê–¶–ò–Ø ============================= */
.nav {
  width: 320px;
  background: var(--bg-glass);
  border-right: 1px solid var(--border);
  padding: 28px;
  position: relative;
  flex-shrink: 0;
  animation: slideInLeft 0.8s ease;
}

@media (max-width: 768px) {
  .nav {
    width: 100%;
    order: 2;
    border-right: none;
    border-top: 1px solid var(--border);
    padding: 24px;
  }
}

.nav .navToggle {
  position: absolute;
  top: 24px;
  right: 24px;
  width: 44px;
  height: 44px;
  background: var(--bg-card);
  border: 2px solid var(--border);
  border-radius: var(--radius-md);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  transition: all 0.4s ease;
  color: var(--text-secondary);
}

.nav .navToggle:hover {
  background: var(--primary);
  color: var(--text-primary);
  border-color: var(--primary);
  transform: rotate(180deg) scale(1.1);
}

@media (max-width: 768px) {
  .nav .navToggle { display: none; }
}

.nav .brand {
  margin-bottom: 28px;
  font-size: 12px;
  font-weight: 700;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 1px;
  padding: 12px 0;
  border-bottom: 1px solid var(--border);
}

.nav .br {
  display: flex;
  align-items: center;
  gap: 16px;
  width: 100%;
  text-align: left;
  margin: 8px 0;
  padding: 16px 20px;
  background: var(--bg-card);
  border: 2px solid transparent;
  border-radius: var(--radius-lg);
  color: var(--text-primary);
  cursor: pointer;
  font-weight: 600;
  font-size: 15px;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  animation: slideInStagger 0.6s ease;
  animation-delay: calc(var(--i) * 0.1s);
}

.nav .br::before {
  content: attr(data-emoji);
  font-size: 20px;
  filter: grayscale(0.5);
  transition: all 0.4s ease;
}

.nav .br:hover {
  background: var(--bg-tertiary);
  border-color: var(--primary);
  transform: translateX(12px) translateY(-3px);
  box-shadow: var(--shadow-lg);
}

.nav .br:hover::before {
  filter: grayscale(0);
  animation: bounce 0.8s ease;
}

.nav .br.active {
  background: linear-gradient(135deg, var(--primary), var(--primary-light));
  color: var(--text-primary);
  border-color: var(--primary);
  animation: glow 3s ease-in-out infinite alternate;
}

.nav .br.active::before {
  filter: grayscale(0);
}

/* –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏—é */
.nav .controls {
  margin-top: 32px;
  padding-top: 24px;
  border-top: 1px solid var(--border);
}

.nav .controls .btn {
  width: 100%;
  margin: 6px 0;
  justify-content: flex-start;
  background: var(--bg-tertiary);
  border-color: var(--border);
  font-size: 13px;
  padding: 12px 16px;
  animation: slideInStagger 0.6s ease;
  animation-delay: calc(var(--i) * 0.1s + 0.5s);
}

.nav .controls .btn:hover {
  background: var(--bg-card);
  transform: translateX(8px);
}

@media (max-width: 768px) {
  .nav .br {
    padding: 18px 24px;
    font-size: 16px;
    margin: 10px 0;
  }
}

/* –°–≤–µ—Ä–Ω—É—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ */
.layout.collapsed .nav { width: 80px; }
.layout.collapsed .nav .brand,
.layout.collapsed .nav .br,
.layout.collapsed .nav .controls { display: none; }

@media (max-width: 768px) {
  .layout.collapsed .nav { width: 100%; }
  .layout.collapsed .nav .brand,
  .layout.collapsed .nav .br,
  .layout.collapsed .nav .controls { display: block; }
}

/* ============================= –ö–û–ù–¢–ï–ù–¢ ============================= */
.content {
  flex: 1;
  padding: 36px;
  overflow-y: auto;
  animation: slideInUp 1s ease;
}

@media (max-width: 768px) {
  .content {
    padding: 28px 24px;
    order: 1;
  }
}

.page {
  display: none;
}

.page.active {
  display: block;
  animation: slideInUp 0.6s ease;
}

/* ============================= –ü–†–û–§–ò–õ–ò ============================= */
.pills {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
}

.pill {
  display: inline-flex;
  align-items: center;
  gap: 12px;
  padding: 14px 22px;
  background: var(--bg-card);
  border: 2px solid var(--border);
  border-radius: var(--radius-lg);
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  font-weight: 600;
  position: relative;
  overflow: hidden;
  animation: fadeInScale 0.6s ease;
}

.pill::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  opacity: 0;
  transition: opacity 0.4s ease;
  z-index: -1;
}

.pill:hover {
  transform: translateY(-6px) scale(1.02);
  box-shadow: var(--shadow-lg);
  border-color: var(--primary);
  background: var(--bg-tertiary);
}

.pill.active::before {
  opacity: 1;
}

.pill.active {
  color: var(--text-primary);
  border-color: var(--primary);
  animation: pulse 3s ease-in-out infinite;
}

.avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--info), var(--accent));
  color: var(--text-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 18px;
  box-shadow: var(--shadow-sm);
  transition: transform 0.3s ease;
}

.pill:hover .avatar {
  transform: scale(1.1) rotate(5deg);
}

@media (max-width: 768px) {
  .pill {
    padding: 16px 24px;
    font-size: 16px;
  }
  
  .avatar {
    width: 44px;
    height: 44px;
    font-size: 20px;
  }
}

/* ============================= –ñ–£–†–ù–ê–õ ============================= */
.log {
  max-height: 500px;
  overflow-y: auto;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  margin: 0;
  padding: 0;
  list-style: none;
  box-shadow: var(--shadow-md);
}

.log li {
  padding: 24px 28px;
  border-bottom: 1px solid var(--border);
  display: grid;
  grid-template-columns: 1fr auto auto auto;
  gap: 20px;
  align-items: center;
  transition: all 0.4s ease;
  position: relative;
  animation: slideInStagger 0.5s ease;
  animation-delay: calc(var(--i) * 0.05s);
}

.log li::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 4px;
  background: var(--primary);
  transform: scaleY(0);
  transition: transform 0.4s ease;
}

.log li:hover {
  background: var(--bg-tertiary);
  transform: translateX(12px);
  box-shadow: var(--shadow-sm);
}

.log li:hover::before {
  transform: scaleY(1);
}

.log li:last-child {
  border-bottom: none;
}

@media (max-width: 768px) {
  .log {
    max-height: 400px;
  }
  
  .log li {
    grid-template-columns: 1fr;
    gap: 12px;
    padding: 20px 24px;
  }
}

.log .del {
  cursor: pointer;
  padding: 10px;
  border-radius: 50%;
  transition: all 0.4s ease;
  color: var(--danger);
  font-size: 18px;
}

.log .del:hover {
  background: rgba(239, 68, 68, 0.2);
  transform: scale(1.3) rotate(15deg);
  box-shadow: var(--shadow-sm);
}

.money.plus {
  color: var(--success);
  font-weight: 700;
  animation: countUp 0.5s ease;
}

.money.minus {
  color: var(--danger);
  font-weight: 700;
  animation: countUp 0.5s ease;
}

/* ============================= –£–õ–£–ß–®–ï–ù–ù–´–ô –ì–†–ê–§–ò–ö ============================= */
.chart-container {
  background: var(--bg-card);
  border-radius: var(--radius-lg);
  padding: 32px;
  border: 1px solid var(--border);
  box-shadow: var(--shadow-lg);
  margin: 24px 0;
  animation: fadeInScale 0.8s ease;
}

.chart-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
}

.chart-title {
  font-size: 20px;
  font-weight: 700;
  color: var(--text-primary);
  display: flex;
  align-items: center;
  gap: 12px;
}

.chart-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 16px;
  margin-bottom: 24px;
}

.stat-card {
  background: var(--bg-tertiary);
  padding: 16px 20px;
  border-radius: var(--radius-md);
  text-align: center;
  border: 1px solid var(--border);
  transition: all 0.3s ease;
  animation: slideInStagger 0.6s ease;
  animation-delay: calc(var(--i) * 0.1s);
}

.stat-card:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-md);
}

.stat-value {
  font-size: 24px;
  font-weight: 700;
  color: var(--text-primary);
  display: block;
  animation: countUp 0.8s ease;
}

.stat-label {
  font-size: 12px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-top: 4px;
}

canvas {
  width: 100%;
  height: 280px;
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  background: var(--bg-primary);
  box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3);
  transition: transform 0.3s ease;
}

canvas:hover {
  transform: scale(1.01);
}

@media (max-width: 768px) {
  canvas { height: 220px; }
  .chart-container { padding: 24px 20px; }
}

/* ============================= –î–û–°–¢–ò–ñ–ï–ù–ò–Ø ============================= */
.achievements-container {
  background: var(--bg-card);
  border-radius: var(--radius-lg);
  padding: 28px;
  border: 1px solid var(--border);
  box-shadow: var(--shadow-lg);
  margin: 24px 0;
  animation: slideInRight 0.8s ease;
}

.achievements-title {
  font-size: 18px;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 12px;
}

.achievements-title::before {
  content: 'üèÜ';
  font-size: 24px;
  animation: sparkle 2s ease-in-out infinite;
}

.achievements-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
}

.achievement-card {
  background: var(--bg-tertiary);
  padding: 20px;
  border-radius: var(--radius-md);
  border: 2px solid transparent;
  transition: all 0.4s ease;
  animation: slideInStagger 0.6s ease;
  animation-delay: calc(var(--i) * 0.1s);
}

.achievement-card.unlocked {
  border-color: var(--success);
  background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1));
  animation: glow 2s ease-in-out infinite alternate;
}

.achievement-card:hover {
  transform: translateY(-4px) scale(1.02);
  box-shadow: var(--shadow-md);
}

.achievement-icon {
  font-size: 32px;
  margin-bottom: 12px;
  display: block;
  animation: float 3s ease-in-out infinite;
}

.achievement-name {
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 8px;
}

.achievement-desc {
  font-size: 13px;
  color: var(--text-secondary);
  line-height: 1.4;
}

/* ============================= –¢–ê–ë–´ ============================= */
.tabs {
  display: flex;
  gap: 8px;
  margin-bottom: 24px;
  background: var(--bg-tertiary);
  border-radius: var(--radius-lg);
  padding: 8px;
  border: 1px solid var(--border);
  animation: slideInUp 0.6s ease;
}

@media (max-width: 768px) {
  .tabs { flex-wrap: wrap; }
}

.tab {
  flex: 1;
  padding: 16px 24px;
  background: transparent;
  color: var(--text-secondary);
  border-radius: var(--radius-md);
  cursor: pointer;
  font-weight: 600;
  text-align: center;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.tab::before {
  content: '';
  position: absolute;
  bottom: 0;
  left: 50%;
  width: 0;
  height: 3px;
  background: var(--primary);
  transition: all 0.4s ease;
  transform: translateX(-50%);
}

.tab:hover {
  background: var(--bg-glass);
  color: var(--text-primary);
  transform: translateY(-3px);
}

.tab.active {
  background: var(--bg-card);
  color: var(--primary);
  box-shadow: var(--shadow-sm);
}

.tab.active::before {
  width: 100%;
}

@media (max-width: 768px) {
  .tab {
    padding: 18px 24px;
    font-size: 16px;
  }
}

.panel {
  display: none;
}

.panel.active {
  display: block;
  animation: slideInUp 0.5s ease;
}

/* ============================= –§–£–¢–ï–† ============================= */
.footer {
  background: var(--bg-tertiary);
  border-top: 1px solid var(--border);
  padding: 28px;
  position: sticky;
  bottom: 0;
  z-index: 50;
  animation: slideInUp 0.8s ease;
}

@media (max-width: 768px) {
  .footer { padding: 24px; }
}

.kpi {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 20px;
  margin-bottom: 20px;
}

.kpi .card {
  background: var(--bg-card);
  padding: 20px 24px;
  border-radius: var(--radius-lg);
  border: 1px solid var(--border);
  font-size: 14px;
  color: var(--text-secondary);
  box-shadow: var(--shadow-sm);
  text-align: center;
  transition: all 0.4s ease;
  position: relative;
  overflow: hidden;
  animation: slideInStagger 0.6s ease;
  animation-delay: calc(var(--i) * 0.1s);
}

.kpi .card::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 2px;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  transition: left 0.6s ease;
}

.kpi .card:hover {
  transform: translateY(-6px);
  box-shadow: var(--shadow-lg);
}

.kpi .card:hover::before {
  left: 100%;
}

.kpi .card b {
  color: var(--text-primary);
  display: block;
  font-size: 20px;
  font-weight: 700;
  margin-top: 8px;
  animation: countUp 0.8s ease;
}

@media (max-width: 768px) {
  .kpi {
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
  }
}

.progress {
  height: 16px;
  background: var(--bg-primary);
  border-radius: var(--radius-sm);
  overflow: hidden;
  position: relative;
  border: 1px solid var(--border);
  box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3);
}

.progress::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg, 
    transparent 25%, 
    rgba(255,255,255,0.1) 25%, 
    rgba(255,255,255,0.1) 50%, 
    transparent 50%, 
    transparent 75%, 
    rgba(255,255,255,0.1) 75%);
  background-size: 20px 20px;
  animation: shimmer 2s linear infinite;
}

.progress > span {
  display: block;
  height: 100%;
  width: 0;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1);
  border-radius: var(--radius-sm);
  position: relative;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
}

/* ============================= –ü–†–û–ö–†–£–¢–ö–ê ============================= */
::-webkit-scrollbar {
  width: 12px;
  height: 12px;
}

::-webkit-scrollbar-track {
  background: var(--bg-primary);
  border-radius: var(--radius-sm);
}

::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  border-radius: var(--radius-sm);
  border: 2px solid var(--bg-primary);
  transition: all 0.3s ease;
}

::-webkit-scrollbar-thumb:hover {
  transform: scale(1.1);
}

/* ============================= –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ ============================= */
@media (max-width: 480px) {
  .title {
    font-size: 18px;
    padding: 16px 20px;
  }
  
  .content {
    padding: 24px 20px;
  }
  
  h3 {
    font-size: 26px;
  }
}

/* ============================= –°–ï–ù–°–û–†–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø ============================= */
@media (hover: none) and (pointer: coarse) {
  .btn:hover {
    transform: none;
  }
  
  .btn:active {
    transform: scale(0.95);
  }
  
  .pill:hover {
    transform: none;
  }
  
  .nav .br:hover {
    transform: none;
  }
}
</style>
</head>
<body>
<div class="app">
  <div class="win">
    <div class="title">
      GradePay ‚Äî –£–º–Ω—ã–π –¥–Ω–µ–≤–Ω–∏–∫ –æ—Ü–µ–Ω–æ–∫
    </div>

    <div class="layout" id="layout">
      <!-- NAV -->
      <aside class="nav" id="leftNav">
        <button class="navToggle" id="navToggle" title="–°–≤–µ—Ä–Ω—É—Ç—å/—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –º–µ–Ω—é">‚öôÔ∏è</button>
        <div class="brand">üéØ –ù–∞–≤–∏–≥–∞—Ü–∏—è</div>
        <button class="br" data-go="profiles" data-emoji="üë®‚Äçüë©‚Äçüëß‚Äçüë¶" style="--i: 0">–ü—Ä–æ—Ñ–∏–ª–∏</button>
        <button class="br" data-go="diary" data-emoji="üìñ" style="--i: 1">–î–Ω–µ–≤–Ω–∏–∫</button>
        <button class="br" data-go="input" data-emoji="‚úèÔ∏è" style="--i: 2">–í–≤–æ–¥ –æ—Ü–µ–Ω–æ–∫</button>
        <button class="br" data-go="summary" data-emoji="üìä" style="--i: 3">–ò—Ç–æ–≥–∏</button>
        <button class="br" data-go="guide" data-emoji="üí°" style="--i: 4">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</button>
        
        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
        <div class="controls">
          <button class="btn" id="btnExportCsv" style="--i: 0">üìä –≠–∫—Å–ø–æ—Ä—Ç CSV</button>
          <button class="btn" id="btnExportJson" style="--i: 1">üíæ –≠–∫—Å–ø–æ—Ä—Ç JSON</button>
          <label class="btn" style="position:relative;overflow:hidden;--i: 2">
            üì• –ò–º–ø–æ—Ä—Ç JSON
            <input id="importJson" type="file" accept="application/json" style="position:absolute;inset:0;opacity:0;cursor:pointer"/>
          </label>
          <button class="btn danger" id="btnResetWeek" style="--i: 3">üîÑ –°–±—Ä–æ—Å –Ω–µ–¥–µ–ª–∏</button>
        </div>
      </aside>

      <!-- CONTENT -->
      <main class="content">
        <!-- –ü—Ä–æ—Ñ–∏–ª–∏ -->
        <section id="page-profiles" class="page">
          <h3>–ü—Ä–æ—Ñ–∏–ª–∏ —É—á–µ–Ω–∏–∫–æ–≤</h3>
          <div class="row">
            <div id="profiles" class="pills"></div>
          </div>
          <div class="row" style="margin-top:20px">
            <input type="text" id="newProfileName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è —É—á–µ–Ω–∏–∫–∞"/>
            <button class="btn primary" id="addProfile">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
          </div>
          <div class="sep"></div>
          <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏</h3>
          <div id="profilesManage"></div>
          <div class="badge info" style="margin-top:20px">üí° –ö–∞–∂–¥—ã–π –ø—Ä–æ—Ñ–∏–ª—å —Ö—Ä–∞–Ω–∏—Ç —Å–≤–æ–∏ –Ω–µ–¥–µ–ª–∏, –ø—Ä–∞–≤–∏–ª–∞ –∏ –∂—É—Ä–Ω–∞–ª. –ü–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º ‚Äî —Å–¥–µ–ª–∞–π—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç JSON –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.</div>
        </section>

        <!-- –î–Ω–µ–≤–Ω–∏–∫ -->
        <section id="page-diary" class="page">
          <h3>–î–Ω–µ–≤–Ω–∏–∫ –Ω–µ–¥–µ–ª–∏</h3>
          <div class="row" style="margin-bottom:20px">
            <label>üìÖ –ù–µ–¥–µ–ª—è: <input type="week" id="weekPick"></label>
            <input type="text" id="filterSubject" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É..."/>
            <select id="filterDay">
              <option value="">üìÜ –í—Å–µ –¥–Ω–∏...</option>
              <option>–ü–Ω</option><option>–í—Ç</option><option>–°—Ä</option><option>–ß—Ç</option><option>–ü—Ç</option><option>–°–±</option>
            </select>
            <button class="btn" id="clearFilters">üóëÔ∏è –°–±—Ä–æ—Å</button>
            <div class="badge">üí° –£–¥–∞–ª—è–π—Ç–µ –∑–∞–ø–∏—Å–∏ –∫–Ω–æ–ø–∫–æ–π üóëÔ∏è –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ¬´–û—Ç–º–µ–Ω–∏—Ç—å¬ª –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–ø–∏—Å–∏</div>
            <span class="row" style="margin-left:auto">
              <button class="btn" id="undo">‚Ü∂ –û—Ç–º–µ–Ω–∏—Ç—å</button>
              <button class="btn danger" id="clearLog">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
            </span>
          </div>
          <ul id="log" class="log"></ul>
        </section>

        <!-- –í–≤–æ–¥ -->
        <section id="page-input" class="page">
          <h3>–í–≤–æ–¥ –æ—Ü–µ–Ω–æ–∫</h3>
          <div class="tabs">
            <div class="tab active" data-tab="tap">üéØ –ë—ã—Å—Ç—Ä—ã–π –≤–≤–æ–¥</div>
            <div class="tab" data-tab="qty">üî¢ –ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É</div>
            <div class="tab" data-tab="voice">üéôÔ∏è –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥</div>
          </div>

          <div id="panel-tap" class="panel active">
            <div class="row" style="margin:20px 0">
              <input type="text" id="subject" placeholder="üìö –ü—Ä–µ–¥–º–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞)"/>
              <select id="daySelect">
                <option value="">üìÖ –î–µ–Ω—å –Ω–µ–¥–µ–ª–∏...</option>
                <option>–ü–Ω</option><option>–í—Ç</option><option>–°—Ä</option><option>–ß—Ç</option><option>–ü—Ç</option><option>–°–±</option>
              </select>
              <button class="btn success" data-add="5">‚≠ê 5</button>
              <button class="btn primary" data-add="4">‚úÖ 4</button>
              <button class="btn warning" data-add="3">‚ö†Ô∏è 3</button>
              <button class="btn danger" data-add="2">‚ùå 2</button>
              <span class="badge">‚å®Ô∏è –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏: 5 / 4 / 3 / 2</span>
            </div>
          </div>

          <div id="panel-qty" class="panel">
            <div class="row" style="margin:20px 0">
              <label>‚≠ê –ü—è—Ç—ë—Ä–∫–∏: <input type="number" id="q5" min="0" value="0"></label>
              <label>‚úÖ –ß–µ—Ç–≤—ë—Ä–∫–∏: <input type="number" id="q4" min="0" value="0"></label>
              <label>‚ö†Ô∏è –¢—Ä–æ–π–∫–∏: <input type="number" id="q3" min="0" value="0"></label>
              <label>‚ùå –î–≤–æ–π–∫–∏: <input type="number" id="q2" min="0" value="0"></label>
              <button class="btn primary" id="applyQty">üíæ –ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
              <button class="btn" id="clearQty">üîÑ –û–±–Ω—É–ª–∏—Ç—å</button>
              <span class="badge success" id="qtyPreview">üí∞ –ü—Ä–µ–¥–ø—Ä–æ—Å—á—ë—Ç: 0 ‚ÇΩ</span>
            </div>
            <div class="badge">üí° ¬´–ü—Ä–∏–º–µ–Ω–∏—Ç—å¬ª —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –∂—É—Ä–Ω–∞–ª: –¥–æ–±–∞–≤–∏—Ç –∏–ª–∏ —É–±–µ—Ä—ë—Ç –∑–∞–ø–∏—Å–∏ –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å—á—ë—Ç—á–∏–∫–∞–º.</div>
          </div>

          <div id="panel-voice" class="panel">
            <div class="row" style="margin:20px 0">
              <button class="btn primary" id="startRec">üéôÔ∏è –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å</button>
              <button class="btn" id="stopRec" disabled>‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
              <span class="badge" id="recState">üî¥ –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</span>
            </div>
            <div class="badge" id="liveText">üëÇ –ì–æ–≤–æ—Ä–∏—Ç–µ...</div>
            <div class="badge">üí° –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥: ¬´–ø—è—Ç—å –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ –≤ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫¬ª, ¬´—á–µ—Ç—ã—Ä–µ –ø–æ —Ä—É—Å—Å–∫–æ–º—É¬ª, ¬´—Ç—Ä–∏ –≤ —Å—Ä–µ–¥—É¬ª.</div>
          </div>
        </section>

        <!-- –ò—Ç–æ–≥–∏ -->
        <section id="page-summary" class="page">
          <h3>–ò—Ç–æ–≥–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h3>
          
          <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
          <div class="row" style="margin-bottom: 32px;">
            <label>üìÖ –ù–µ–¥–µ–ª—è: <input type="week" id="weekPick2"></label>
            <label>‚≠ê –ü—è—Ç—ë—Ä–∫–∞ = <input type="number" id="p5" value="300" step="50"> ‚ÇΩ</label>
            <label>‚úÖ –ß–µ—Ç–≤—ë—Ä–∫–∞ = <input type="number" id="p4" value="150" step="50"> ‚ÇΩ</label>
            <label>‚ö†Ô∏è –¢—Ä–æ–π–∫–∞ = <input type="number" id="p3" value="-150" step="50"> ‚ÇΩ</label>
            <label>‚ùå –î–≤–æ–π–∫–∞ = <input type="number" id="p2" value="-300" step="50"> ‚ÇΩ</label>
            <label style="margin-left:auto">üéØ –¶–µ–ª—å –Ω–µ–¥–µ–ª–∏: <input type="number" id="goal" value="1000" step="50"> ‚ÇΩ</label>
          </div>

          <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
          <div class="chart-container">
            <div class="chart-header">
              <div class="chart-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ü–µ–Ω–æ–∫</div>
            </div>
            <div class="chart-stats">
              <div class="stat-card" style="--i: 0">
                <span class="stat-value" id="stat5">0</span>
                <div class="stat-label">‚≠ê –ü—è—Ç—ë—Ä–∫–∏</div>
              </div>
              <div class="stat-card" style="--i: 1">
                <span class="stat-value" id="stat4">0</span>
                <div class="stat-label">‚úÖ –ß–µ—Ç–≤—ë—Ä–∫–∏</div>
              </div>
              <div class="stat-card" style="--i: 2">
                <span class="stat-value" id="stat3">0</span>
                <div class="stat-label">‚ö†Ô∏è –¢—Ä–æ–π–∫–∏</div>
              </div>
              <div class="stat-card" style="--i: 3">
                <span class="stat-value" id="stat2">0</span>
                <div class="stat-label">‚ùå –î–≤–æ–π–∫–∏</div>
              </div>
              <div class="stat-card" style="--i: 4">
                <span class="stat-value" id="statTotal">0</span>
                <div class="stat-label">üìù –í—Å–µ–≥–æ</div>
              </div>
              <div class="stat-card" style="--i: 5">
                <span class="stat-value" id="statAvg">0.0</span>
                <div class="stat-label">üìà –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div>
              </div>
            </div>
            <canvas id="chart"></canvas>
          </div>

          <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è -->
          <div class="achievements-container">
            <div class="achievements-title">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è —ç—Ç–æ–π –Ω–µ–¥–µ–ª–∏</div>
            <div class="achievements-grid" id="achievementsGrid">
              <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ JS -->
            </div>
          </div>
        </section>

        <!-- –ì–∞–π–¥ -->
        <section id="page-guide" class="page">
          <h3>–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
          <div style="background: var(--bg-card); padding: 32px; border-radius: var(--radius-lg); border: 1px solid var(--border);">
            <ol style="font-size: 16px; line-height: 1.8; color: var(--text-secondary);">
              <li><strong style="color: var(--text-primary);">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å —Ä–µ–±—ë–Ω–∫–∞.</strong> –£ –∫–∞–∂–¥–æ–≥–æ —É—á–µ–Ω–∏–∫–∞ —Å–≤–æ–∏ –ø—Ä–∞–≤–∏–ª–∞ –∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∂—É—Ä–Ω–∞–ª –æ—Ü–µ–Ω–æ–∫.</li>
              <li><strong style="color: var(--text-primary);">üìÖ –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–±–æ—á—É—é –Ω–µ–¥–µ–ª—é.</strong> –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ä–∞–∑–¥–µ–ª—å–Ω–æ –ø–æ –Ω–µ–¥–µ–ª—è–º –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞.</li>
              <li><strong style="color: var(--text-primary);">üí∞ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –ø–æ–æ—â—Ä–µ–Ω–∏–π.</strong> –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ—Ü–µ–Ω–æ–∫: 5/4 ‚Äî –Ω–∞–≥—Ä–∞–¥—ã, 3/2 ‚Äî —à—Ç—Ä–∞—Ñ—ã.</li>
              <li><strong style="color: var(--text-primary);">‚úèÔ∏è –í–µ–¥–∏—Ç–µ —É—á—ë—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω–æ.</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±—ã—Å—Ç—Ä—ã–π –≤–≤–æ–¥ –∫–Ω–æ–ø–∫–∞–º–∏, –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–≤–æ–¥ –∏–ª–∏ –≥–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã.</li>
              <li><strong style="color: var(--text-primary);">üìä –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å.</strong> –ï–∂–µ–¥–Ω–µ–≤–Ω–æ —Ç—Ä–∞—Ç—å—Ç–µ 3 –º–∏–Ω—É—Ç—ã –Ω–∞ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å —Ä–µ–±—ë–Ω–∫–æ–º.</li>
              <li><strong style="color: var(--text-primary);">üéÅ –°–∏—Å—Ç–µ–º–∞ –Ω–∞–≥—Ä–∞–¥.</strong> 50% –æ—Ç —Ü–µ–ª–∏ ‚Äî –∞–≤–∞–Ω—Å, 100% ‚Äî –ø–æ–ª–Ω–∞—è ¬´–∑–∞—Ä–ø–ª–∞—Ç–∞¬ª –∏–ª–∏ –ø–æ—Ö–æ–¥ –≤ –∫–∏–Ω–æ.</li>
              <li><strong style="color: var(--text-primary);">üèÜ –û—Ç–º–µ—á–∞–π—Ç–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è.</strong> –ë–µ–∑ –¥–≤–æ–µ–∫, —Å–µ—Ä–∏—è –ø—è—Ç—ë—Ä–æ–∫, —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ —á–µ—Ç–≤—ë—Ä–∫–∏ ‚Äî –≤—Å—ë —ç—Ç–æ –º–æ—Ç–∏–≤–∏—Ä—É–µ—Ç!</li>
              <li><strong style="color: var(--text-primary);">üìà –°—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ.</strong> –¢–æ–ª—å–∫–æ —Å –ø—Ä–æ—à–ª—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Ä–µ–±—ë–Ω–∫–∞, –∞ –Ω–µ —Å –¥—Ä—É–≥–∏–º–∏ –¥–µ—Ç—å–º–∏.</li>
              <li><strong style="color: var(--text-primary);">üíæ –î–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏.</strong> CSV –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤, JSON –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞ –¥–∞–Ω–Ω—ã—Ö.</li>
              <li><strong style="color: var(--text-primary);">üîÑ –ù–µ –±–æ–π—Ç–µ—Å—å –æ—à–∏–±–æ–∫.</strong> –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ ‚Äî ¬´–°–±—Ä–æ—Å –Ω–µ–¥–µ–ª–∏¬ª –ø–æ–º–æ–∂–µ—Ç –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ.</li>
            </ol>
          </div>
        </section>
      </main>
    </div>

    <!-- FOOTER KPI -->
    <div class="footer">
      <div class="kpi">
        <div class="card" style="--i: 0">üë§ –ü—Ä–æ—Ñ–∏–ª—å <b id="kProfile">‚Äî</b></div>
        <div class="card" style="--i: 1">üìÖ –ù–µ–¥–µ–ª—è <b id="kWeek">‚Äî</b></div>
        <div class="card" style="--i: 2">üí∞ –ò—Ç–æ–≥–æ <b id="kTotal">0 ‚ÇΩ</b></div>
        <div class="card" style="--i: 3">üéØ –¶–µ–ª—å <b id="kGoal">‚Äî</b></div>
        <div class="card" style="--i: 4">üìä –í—ã–ø–æ–ª–Ω–µ–Ω–æ <b id="kPct">0%</b></div>
        <div class="card" style="--i: 5">üöÄ –°—Ç–∞—Ç—É—Å <b id="kBadge">–°—Ç–∞—Ä—Ç</b></div>
      </div>
      <div class="progress"><span id="kBar"></span></div>
    </div>
  </div>
</div>

<script>
/* ============================= HELPERS & STATE ============================= */
const $=s=>document.querySelector(s), $$=s=>Array.from(document.querySelectorAll(s));
const money=n=>(n>=0? n.toLocaleString('ru-RU')+' ‚ÇΩ':'‚àí'+Math.abs(n).toLocaleString('ru-RU')+' ‚ÇΩ');
const esc=s=>String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]));
const uid=()=>Math.random().toString(36).slice(2,9);

const Store=(()=>{
  const st={profileId:null,profileName:'',week:'',prices:{5:300,4:150,3:-150,2:-300},goal:1000,counts:{5:0,4:0,3:0,2:0},log:[]};
  const subs=new Set();
  const get=()=>JSON.parse(JSON.stringify(st));
  const set=x=>{Object.assign(st,x); notify();};
  const setCounts=x=>{st.counts=x; notify();};
  const setLog=x=>{st.log=x; notify();};
  const addEntry=it=>{st.log.unshift(it); st.counts[it.grade]=(st.counts[it.grade]||0)+1; notify();};
  const removeEntry=id=>{const i=st.log.findIndex(x=>x.id===id); if(i>=0){const g=st.log[i].grade; st.log.splice(i,1); st.counts[g]=Math.max(0,(st.counts[g]||0)-1); notify();}};
  const undo=()=>{if(!st.log.length) return; const it=st.log.shift(); st.counts[it.grade]=Math.max(0,(st.counts[it.grade]||0)-1); notify();};
  const clearWeek=()=>{st.counts={5:0,4:0,3:0,2:0}; st.log=[]; notify();};
  const subscribe=fn=>subs.add(fn), unsubscribe=fn=>subs.delete(fn), notify=()=>subs.forEach(fn=>fn(get()));
  return {get,set,setCounts,setLog,addEntry,removeEntry,undo,clearWeek,subscribe,unsubscribe};
})();

/* ============================= PROFILES LIST ============================= */
let profiles=[];
function loadProfiles(){ try{profiles=JSON.parse(localStorage.getItem('gp_profiles_v1')||'[]');}catch{profiles=[]}
  if(!profiles.length){ profiles=[{id:uid(),name:'–†–µ–±—ë–Ω–æ–∫'}]; saveProfiles(); }
  drawProfiles(); selectProfile(profiles[0].id);
}
function saveProfiles(){ localStorage.setItem('gp_profiles_v1', JSON.stringify(profiles)); }
function drawProfiles(){
  const box=$('#profiles'); box.innerHTML='';
  profiles.forEach(p=>{
    const el=document.createElement('div'); el.className='pill'; el.dataset.id=p.id;
    el.innerHTML=`<span class="avatar">${(p.name||'?')[0]?.toUpperCase()||'?'}</span><span>${p.name||'–ë–µ–∑ –∏–º–µ–Ω–∏'}</span>`;
    el.onclick=()=>selectProfile(p.id);
    box.appendChild(el);
  });
  drawProfilesManage();
}
function drawProfilesManage(){
  const box=$('#profilesManage'); box.innerHTML='';
  profiles.forEach(p=>{
    const row=document.createElement('div'); row.className='row';
    const inp=document.createElement('input'); inp.value=p.name; inp.style.minWidth='200px';
    const use=document.createElement('button'); use.className='btn primary'; use.textContent='‚úÖ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å';
    const del=document.createElement('button'); del.className='btn danger'; del.textContent='üóëÔ∏è –£–¥–∞–ª–∏—Ç—å';
    inp.oninput=()=>{p.name=inp.value; saveProfiles(); drawProfiles(); if(Store.get().profileId===p.id) Store.set({profileName:p.name});};
    use.onclick=()=>selectProfile(p.id);
    del.onclick=()=>{
      if(!confirm('‚ùì –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –∏ –≤—Å–µ –µ–≥–æ –¥–∞–Ω–Ω—ã–µ?')) return;
      Object.keys(localStorage).forEach(k=>{ if(k.startsWith('gp_data_'+p.id+'_')) localStorage.removeItem(k); });
      profiles=profiles.filter(x=>x.id!==p.id); if(!profiles.length){profiles=[{id:uid(),name:'–†–µ–±—ë–Ω–æ–∫'}];}
      saveProfiles(); drawProfiles(); selectProfile(profiles[0].id);
    };
    row.appendChild(inp); row.appendChild(use); row.appendChild(del);
    box.appendChild(row);
  });
}
$('#addProfile').onclick=()=>{
  const name=($('#newProfileName').value||'').trim()||'–ù–æ–≤—ã–π —É—á–µ–Ω–∏–∫';
  const p={id:uid(),name}; profiles.push(p); saveProfiles(); drawProfiles(); selectProfile(p.id); $('#newProfileName').value='';
};

function ensureISOWeek(){
  const now=new Date();
  const t=new Date(Date.UTC(now.getFullYear(),now.getMonth(),now.getDate()));
  const dow=t.getUTCDay()||7; t.setUTCDate(t.getUTCDate()+4-dow);
  const s=new Date(Date.UTC(t.getUTCFullYear(),0,1));
  const w=String(Math.ceil((((t-s)/86400000)+1)/7)).padStart(2,'0');
  const val=now.getUTCFullYear()+'-W'+w;
  $('#weekPick').value=val; $('#weekPick2').value=val;
  return val;
}
function key(){ const s=Store.get(); return 'gp_data_'+s.profileId+'_'+(s.week||ensureISOWeek()); }
function saveWeek(){ const s=Store.get(); localStorage.setItem(key(), JSON.stringify({prices:s.prices,goal:s.goal,counts:s.counts,log:s.log})); renderKPI(); }
function loadWeek(){
  const raw=localStorage.getItem(key());
  if(!raw){
    Store.set({prices:{5:300,4:150,3:-150,2:-300},goal:1000}); Store.setCounts({5:0,4:0,3:0,2:0}); Store.setLog([]);
  }else{
    try{ const d=JSON.parse(raw);
      Store.set({prices:d.prices||{5:300,4:150,3:-150,2:-300},goal:d.goal||1000});
      Store.setCounts(d.counts||{5:0,4:0,3:0,2:0}); Store.setLog(d.log||[]);
    }catch{ Store.set({prices:{5:300,4:150,3:-150,2:-300},goal:1000}); Store.setCounts({5:0,4:0,3:0,2:0}); Store.setLog([]); }
  }
  renderAll(Store.get());
}

function selectProfile(id){
  const p=profiles.find(x=>x.id===id); if(!p) return;
  const week=ensureISOWeek();
  Store.set({profileId:id,profileName:p.name,week});
  $$('#profiles .pill').forEach(n=>n.classList.toggle('active', n.dataset.id===id));
  loadWeek(); renderKPI();
}

/* ============================= NAV ============================= */
const routes=['profiles','diary','input','summary','guide'];
function go(to){ routes.forEach(r=>{ $('#page-'+r).classList.toggle('active', r===to); }); $$('.nav .br').forEach(b=>b.classList.toggle('active', b.dataset.go===to)); location.hash=to; }
window.addEventListener('hashchange',()=>{ const h=location.hash.replace('#',''); if(routes.includes(h)) go(h); });
$$('.nav .br').forEach(b=>b.addEventListener('click',()=>go(b.dataset.go)));
go(location.hash.replace('#','')||'diary');

/* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Å–≤—ë—Ä–Ω—É—Ç–æ–≥–æ –º–µ–Ω—é */
const layout = document.getElementById('layout');
const navToggle = document.getElementById('navToggle');
if (localStorage.getItem('gp_nav_collapsed')==='1') layout.classList.add('collapsed');
navToggle.addEventListener('click', ()=>{
  layout.classList.toggle('collapsed');
  localStorage.setItem('gp_nav_collapsed', layout.classList.contains('collapsed') ? '1' : '0');
});

/* ============================= RENDER ============================= */
Store.subscribe(renderAll);
function renderAll(s){
  $('#p5').value=s.prices[5]; $('#p4').value=s.prices[4]; $('#p3').value=s.prices[3]; $('#p2').value=s.prices[2]; $('#goal').value=s.goal;
  $('#q5').value=s.counts[5]; $('#q4').value=s.counts[4]; $('#q3').value=s.counts[3]; $('#q2').value=s.counts[2];
  $('#kProfile').textContent=s.profileName||'‚Äî'; $('#kWeek').textContent=s.week||'‚Äî';
  renderKPI(); renderAchievements(s); drawLog(s); drawChart(s.counts); renderStats(s.counts);
  updateQtyPreview();
}
function renderKPI(){
  const s=Store.get();
  const total=s.counts[5]*s.prices[5]+s.counts[4]*s.prices[4]+s.counts[3]*s.prices[3]+s.counts[2]*s.prices[2];
  $('#kTotal').textContent=money(total);
  $('#kGoal').textContent=s.goal?money(s.goal):'‚Äî';
  const pct=s.goal?Math.max(0,Math.min(100,Math.round(total/s.goal*100))):0;
  $('#kPct').textContent=s.goal?(pct+'%'):'‚Äî'; $('#kBar').style.width=(s.goal?pct:0)+'%';
  $('#kBadge').textContent=s.goal&&total>=s.goal?'üéâ –¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞!': total>0?'üìà –ü—Ä–æ–≥—Ä–µ—Å—Å': (total<0?'‚ö†Ô∏è –ù—É–∂–Ω–æ –ø–æ–¥—Ç—è–Ω—É—Ç—å—Å—è':'üöÄ –°—Ç–∞—Ä—Ç');
}

/* ============================= –£–õ–£–ß–®–ï–ù–ù–ê–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ê ============================= */
function renderStats(counts) {
  if(!$('#stat5')) return;
  
  // –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
  const total = counts[5] + counts[4] + counts[3] + counts[2];
  const avg = total > 0 ? ((counts[5]*5 + counts[4]*4 + counts[3]*3 + counts[2]*2) / total) : 0;
  
  animateNumber($('#stat5'), counts[5]);
  animateNumber($('#stat4'), counts[4]);
  animateNumber($('#stat3'), counts[3]);
  animateNumber($('#stat2'), counts[2]);
  animateNumber($('#statTotal'), total);
  animateNumber($('#statAvg'), avg, true);
}

function animateNumber(element, target, isFloat = false) {
  if(!element) return;
  const start = parseFloat(element.textContent) || 0;
  const duration = 800;
  const startTime = performance.now();
  
  function update(currentTime) {
    const elapsed = currentTime - startTime;
    const progress = Math.min(elapsed / duration, 1);
    const eased = 1 - Math.pow(1 - progress, 3); // easeOutCubic
    const current = start + (target - start) * eased;
    
    element.textContent = isFloat ? current.toFixed(1) : Math.round(current);
    
    if (progress < 1) {
      requestAnimationFrame(update);
    }
  }
  
  requestAnimationFrame(update);
}

function renderAchievements(s){
  const grid = $('#achievementsGrid');
  if(!grid) return;
  
  const achievements = [
    {
      id: 'no_twos',
      icon: 'ü•á',
      name: '–ë–µ–∑ –¥–≤–æ–µ–∫',
      desc: '–ü—Ä–æ–≤–µ—Å—Ç–∏ –Ω–µ–¥–µ–ª—é –±–µ–∑ –µ–¥–∏–Ω–æ–π –¥–≤–æ–π–∫–∏',
      unlocked: s.counts[2] === 0 && (s.counts[5]+s.counts[4]+s.counts[3]) > 0
    },
    {
      id: 'three_fives',
      icon: '‚≠ê',
      name: '–¢—Ä–∏ –ø—è—Ç—ë—Ä–∫–∏',
      desc: '–ü–æ–ª—É—á–∏—Ç—å 3 –∏–ª–∏ –±–æ–ª—å—à–µ –ø—è—Ç—ë—Ä–æ–∫ –∑–∞ –Ω–µ–¥–µ–ª—é',
      unlocked: s.counts[5] >= 3
    },
    {
      id: 'stable_fours',
      icon: '‚úÖ',
      name: '–°—Ç–∞–±–∏–ª—å–Ω—ã–µ —á–µ—Ç–≤—ë—Ä–∫–∏',
      desc: '–ü–æ–ª—É—á–∏—Ç—å 5 –∏–ª–∏ –±–æ–ª—å—à–µ —á–µ—Ç–≤—ë—Ä–æ–∫ –∑–∞ –Ω–µ–¥–µ–ª—é',
      unlocked: s.counts[4] >= 5
    },
    {
      id: 'strong_week',
      icon: 'üí™',
      name: '–°–∏–ª—å–Ω–∞—è –Ω–µ–¥–µ–ª—è',
      desc: '–ü–æ–ª—É—á–∏—Ç—å 8 –∏–ª–∏ –±–æ–ª—å—à–µ —Ö–æ—Ä–æ—à–∏—Ö –æ—Ü–µ–Ω–æ–∫ (4-5)',
      unlocked: (s.counts[5]+s.counts[4]) >= 8
    },
    {
      id: 'excellent_week',
      icon: 'üåü',
      name: '–û—Ç–ª–∏—á–Ω–∞—è –Ω–µ–¥–µ–ª—è',
      desc: '–ü–æ–ª—É—á–∏—Ç—å 5 –∏–ª–∏ –±–æ–ª—å—à–µ –ø—è—Ç—ë—Ä–æ–∫ –∑–∞ –Ω–µ–¥–µ–ª—é',
      unlocked: s.counts[5] >= 5
    },
    {
      id: 'perfect_balance',
      icon: '‚öñÔ∏è',
      name: '–ò–¥–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å',
      desc: '–ë–æ–ª—å—à–µ —Ö–æ—Ä–æ—à–∏—Ö –æ—Ü–µ–Ω–æ–∫, —á–µ–º –ø–ª–æ—Ö–∏—Ö',
      unlocked: (s.counts[5]+s.counts[4]) > (s.counts[3]+s.counts[2]) && (s.counts[3]+s.counts[2]) > 0
    }
  ];
  
  grid.innerHTML = '';
  achievements.forEach((ach, i) => {
    const card = document.createElement('div');
    card.className = `achievement-card ${ach.unlocked ? 'unlocked' : ''}`;
    card.style.setProperty('--i', i);
    card.innerHTML = `
      <span class="achievement-icon">${ach.icon}</span>
      <div class="achievement-name">${ach.name}</div>
      <div class="achievement-desc">${ach.desc}</div>
    `;
    grid.appendChild(card);
  });
}

/* ============================= JOURNAL DRAW + FILTERS ============================= */
function drawLog(s){
  const ul=$('#log'); if(!ul) return; ul.innerHTML='';
  const fs=($('#filterSubject').value||'').trim().toLowerCase();
  const fd=$('#filterDay').value||'';
  s.log.forEach((it, i)=>{
    const subj=(it.subj||'').toLowerCase();
    if(fs && !subj.includes(fs)) return;
    if(fd && (it.day||'')!==fd) return;
    const li=document.createElement('li'); li.dataset.id=it.id;
    li.style.setProperty('--i', i);
    const gradeEmoji = it.grade===5?'‚≠ê':it.grade===4?'‚úÖ':it.grade===3?'‚ö†Ô∏è':'‚ùå';
    li.innerHTML=`<span class="t">${gradeEmoji} <strong>${it.grade}</strong> ‚Äî ${esc(it.subj)||'üìö –±–µ–∑ –ø—Ä–µ–¥–º–µ—Ç–∞'} ${it.day? '('+it.day+')':''}</span>
                  <span class="badge">${it.src||'–≤–≤–æ–¥'}</span>
                  <span class="money ${it.amount>=0?'plus':'minus'}">${money(it.amount)}</span>
                  <span class="del" title="–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å">üóëÔ∏è</span>`;
    li.querySelector('.del').onclick=()=>{Store.removeEntry(it.id); saveWeek();};
    ul.appendChild(li);
  });
}
$('#filterSubject')?.addEventListener('input', ()=>drawLog(Store.get()));
$('#filterDay')?.addEventListener('input', ()=>drawLog(Store.get()));
$('#clearFilters')?.addEventListener('click', ()=>{ $('#filterSubject').value=''; $('#filterDay').value=''; drawLog(Store.get()); });
$('#undo')?.addEventListener('click', ()=>{ Store.undo(); saveWeek(); });
$('#clearLog')?.addEventListener('click', ()=>{
  if(!confirm('‚ùì –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∂—É—Ä–Ω–∞–ª –Ω–µ–¥–µ–ª–∏?')) return;
  Store.clearWeek(); saveWeek();
});

/* ============================= –£–õ–£–ß–®–ï–ù–ù–´–ô –ì–†–ê–§–ò–ö ============================= */
function drawChart(counts){
  const c=$('#chart'); if(!c) return; const ctx=c.getContext('2d');
  const W=c.width=c.clientWidth*2, H=c.height=280*2; ctx.clearRect(0,0,W,H);
  const data=[counts[5],counts[4],counts[3],counts[2]], labels=['‚≠ê','‚úÖ','‚ö†Ô∏è','‚ùå']; const max=Math.max(1,...data);
  const pad=80, col=(W-pad*2)/4, bw=col*0.8;
  
  // –§–æ–Ω —Å —Å–µ—Ç–∫–æ–π
  ctx.strokeStyle = '#334155';
  ctx.lineWidth = 1;
  for(let i = 1; i <= 5; i++) {
    const y = pad + (H-pad*2) * (i/5);
    ctx.beginPath();
    ctx.moveTo(pad, y);
    ctx.lineTo(W-pad, y);
    ctx.stroke();
  }
  
  // –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
  data.forEach((v,i)=>{
    const x=pad+i*col+(col-bw)/2, h=(v/max)*(H-pad*2), y=H-pad-h;
    
    // –¢–µ–Ω—å
    ctx.shadowColor = 'rgba(0,0,0,0.5)';
    ctx.shadowBlur = 20;
    ctx.shadowOffsetX = 0;
    ctx.shadowOffsetY = 8;
    
    // –°–æ–∑–¥–∞–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞
    const gradient = ctx.createLinearGradient(0, y, 0, y + h);
    if(i===0) { // –ü—è—Ç—ë—Ä–∫–∏
      gradient.addColorStop(0, '#10b981');
      gradient.addColorStop(0.5, '#059669');
      gradient.addColorStop(1, '#047857');
    } else if(i===1) { // –ß–µ—Ç–≤—ë—Ä–∫–∏  
      gradient.addColorStop(0, '#6366f1');
      gradient.addColorStop(0.5, '#4f46e5');
      gradient.addColorStop(1, '#4338ca');
    } else if(i===2) { // –¢—Ä–æ–π–∫–∏
      gradient.addColorStop(0, '#f59e0b');
      gradient.addColorStop(0.5, '#d97706');
      gradient.addColorStop(1, '#b45309');
    } else { // –î–≤–æ–π–∫–∏
      gradient.addColorStop(0, '#ef4444');
      gradient.addColorStop(0.5, '#dc2626');
      gradient.addColorStop(1, '#b91c1c');
    }
    
    ctx.fillStyle = gradient;
    ctx.fillRect(x, y, bw, h);
    ctx.shadowBlur = 0;
    
    // –ü–æ–¥–ø–∏—Å–∏ —ç–º–æ–¥–∑–∏
    ctx.fillStyle='#f8fafc'; 
    ctx.font='bold 48px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto'; 
    ctx.textAlign='center';
    ctx.fillText(labels[i], x+bw/2, H-20);
    
    // –ó–Ω–∞—á–µ–Ω–∏—è –Ω–∞ —Å—Ç–æ–ª–±—Ü–∞—Ö
    if(v > 0) {
      ctx.fillStyle='#ffffff';
      ctx.font='bold 36px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto';
      ctx.shadowColor = 'rgba(0,0,0,0.8)';
      ctx.shadowBlur = 4;
      if(h > 60) ctx.fillText(v, x+bw/2, y+h/2+15);
      ctx.shadowBlur = 0;
    }
    
    // –ó–Ω–∞—á–µ–Ω–∏—è —Å–≤–µ—Ä—Ö—É
    ctx.fillStyle='#f8fafc';
    ctx.font='bold 40px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto';
    ctx.fillText(v, x+bw/2, y-20);
  });
}

/* ============================= INPUT: –∫–Ω–æ–ø–∫–∏ / qty / hotkeys ============================= */
function addEntry(grade, subj='', day='', src='–≤–≤–æ–¥'){
  const s=Store.get(); const amt=s.prices[grade];
  Store.addEntry({id:Date.now().toString(36)+uid(),grade,subj,day,amount:amt,src}); saveWeek();
  $('#log')?.scrollTo({top:0, behavior:'smooth'});
}
$$('[data-add]').forEach(b=>b.addEventListener('click',()=>{
  addEntry(+b.dataset.add, $('#subject').value.trim(), $('#daySelect').value, '–∫–Ω–æ–ø–∫–∞');
  $('#subject').value=''; $('#daySelect').value='';
}));
document.addEventListener('keydown',e=>{
  if(/input|select|textarea/i.test(e.target.tagName)) return;
  if(['5','4','3','2'].includes(e.key)) addEntry(+e.key,'','', '–∫–ª–∞–≤–∏—à–∞');
});

/* –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ */
function qObj(){ return {5:+$('#q5').value||0,4:+$('#q4').value||0,3:+$('#q3').value||0,2:+$('#q2').value||0}; }
function updateQtyPreview(){
  if(!$('#qtyPreview')) return;
  const s=Store.get(), q=qObj();
  const t=q[5]*s.prices[5]+q[4]*s.prices[4]+q[3]*s.prices[3]+q[2]*s.prices[2];
  $('#qtyPreview').textContent='üí∞ –ü—Ä–µ–¥–ø—Ä–æ—Å—á—ë—Ç: '+money(t);
}
['#q5','#q4','#q3','#q2'].forEach(sel=>$(sel)?.addEventListener('input', updateQtyPreview));
$('#clearQty')?.addEventListener('click',()=>{['#q5','#q4','#q3','#q2'].forEach(sel=>$(sel).value=0); updateQtyPreview();});
$('#applyQty')?.addEventListener('click',()=>{ syncLogToCounts(qObj()); });

function syncLogToCounts(target){
  const s=Store.get(); const cur={...s.counts};
  const kept={5:0,4:0,3:0,2:0}; const newLog=[];
  for(const it of s.log){ const g=it.grade; if(kept[g]<target[g]){ newLog.push(it); kept[g]++; } }
  const toAdd={5:target[5]-kept[5],4:target[4]-kept[4],3:target[3]-kept[3],2:target[2]-kept[2]};
  const adds=[];
  Object.entries(toAdd).forEach(([g,d])=>{ for(let i=0;i<d;i++) adds.push({id:Date.now().toString(36)+uid(),grade:+g,subj:'',day:'',amount:s.prices[+g],src:'–∫–æ–ª-–≤–æ'}); });
  Store.setLog(adds.concat(newLog)); Store.setCounts(target); saveWeek();
  $('#q5').value=target[5]; $('#q4').value=target[4]; $('#q3').value=target[3]; $('#q2').value=target[2]; updateQtyPreview();
}

/* Tabs inside Input */
$$('.tab').forEach(t=>t.addEventListener('click',()=>{
  $$('.tab').forEach(x=>x.classList.remove('active')); $$('.panel').forEach(x=>x.classList.remove('active'));
  t.classList.add('active'); $('#panel-'+t.dataset.tab).classList.add('active');
}));

/* ============================= PRICES & GOAL ============================= */
['p5','p4','p3','p2'].forEach(id=>{
  $('#'+id)?.addEventListener('input',()=>{ const s=Store.get(); const prices={...s.prices}; prices[+id.slice(1)]=+$('#'+id).value||0; Store.set({prices}); saveWeek(); updateQtyPreview(); });
});
$('#goal')?.addEventListener('input',()=>{ Store.set({goal:+$('#goal').value||0}); saveWeek(); });

/* Weeks (both places) */
function setWeekAll(val){ Store.set({week:val}); $('#weekPick').value=val; $('#weekPick2').value=val; loadWeek(); }
$('#weekPick')?.addEventListener('input',()=>setWeekAll($('#weekPick').value));
$('#weekPick2')?.addEventListener('input',()=>setWeekAll($('#weekPick2').value));

/* ============================= VOICE ============================= */
const recBadge=$('#recState'), live=$('#liveText'); let recog=null;
function SR(){ return window.SpeechRecognition||window.webkitSpeechRecognition; }
function ensureRec(){ const R=SR(); if(!R){ alert('üéôÔ∏è –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥ —Ç—Ä–µ–±—É–µ—Ç Chrome/Edge/Safari –∏ –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É.'); return null; } const r=new R(); r.lang='ru-RU'; r.interimResults=true; r.continuous=true; return r; }
function parseSpeech(text){
  const t=text.toLowerCase().replace(/[.,!?]/g,' ').replace(/\s+/g,' ').trim();
  let day=''; if(t.includes('–ø–Ω')||t.includes('–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫')) day='–ü–Ω'; else if(t.includes('–≤—Ç')||t.includes('–≤—Ç–æ—Ä–Ω–∏–∫')) day='–í—Ç'; else if(t.includes('—Å—Ä')||t.includes('—Å—Ä–µ–¥–∞')) day='–°—Ä'; else if(t.includes('—á—Ç')||t.includes('—á–µ—Ç–≤–µ—Ä–≥')) day='–ß—Ç'; else if(t.includes('–ø—Ç')||t.includes('–ø—è—Ç–Ω–∏—Ü')) day='–ü—Ç'; else if(t.includes('—Å–±')||t.includes('—Å—É–±–±–æ—Ç')) day='–°–±';
  let subj=''; const m=t.match(/–ø–æ ([–∞-—è—ëa-z ]{2,30})/i); if(m) subj=m[1].trim();
  let g=null; if(/\b5\b/.test(t)||t.includes('–ø—è—Ç—å')||t.includes('–ø—è—Ç—ë—Ä')) g=5; else if(/\b4\b/.test(t)||t.includes('—á–µ—Ç—ã—Ä')) g=4; else if(/\b3\b/.test(t)||t.includes('—Ç—Ä–∏')||t.includes('—Ç—Ä–æ–π')) g=3; else if(/\b2\b/.test(t)||t.includes('–¥–≤–∞')||t.includes('–¥–≤–æ–π')) g=2;
  if(g!=null) addEntry(g, subj, day, '–≥–æ–ª–æ—Å');
}
$('#startRec')?.addEventListener('click',()=>{
  if(recog) return; recog=ensureRec(); if(!recog) return;
  recBadge.textContent='üü¢ –°–ª—É—à–∞—é...'; $('#stopRec').disabled=false; $('#startRec').disabled=true; let interim='';
  recog.onresult=(e)=>{ let fin=''; for(let i=e.resultIndex;i<e.results.length;i++){const r=e.results[i]; if(r.isFinal) fin+=r[0].transcript+' '; else interim+=r[0].transcript;}
    if(fin){ live.textContent='‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ: '+fin.trim(); parseSpeech(fin); interim=''; setTimeout(()=>live.textContent='üëÇ –ì–æ–≤–æ—Ä–∏—Ç–µ...',2000); } else live.textContent='üëÇ ' + interim; };
  recog.onend=()=>{ recBadge.textContent='üî¥ –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ'; $('#stopRec').disabled=true; $('#startRec').disabled=false; recog=null; live.textContent='üëÇ –ì–æ–≤–æ—Ä–∏—Ç–µ...'; };
  recog.onerror=()=>{ recBadge.textContent='‚ùå –û—à–∏–±–∫–∞'; $('#stopRec').disabled=true; $('#startRec').disabled=false; recog=null; live.textContent='‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è'; };
  recog.start();
});
$('#stopRec')?.addEventListener('click',()=>{ if(recog) recog.stop(); });

/* ============================= EXPORT / IMPORT / RESET ============================= */
$('#btnExportCsv')?.addEventListener('click',()=>{
  const s=Store.get();
  const rows=[['–ü—Ä–æ—Ñ–∏–ª—å',s.profileName],['–ù–µ–¥–µ–ª—è',s.week],
    ['–ü—Ä–∞–π—Å 5',s.prices[5]],['–ü—Ä–∞–π—Å 4',s.prices[4]],['–ü—Ä–∞–π—Å 3',s.prices[3]],['–ü—Ä–∞–π—Å 2',s.prices[2]],
    ['–¶–µ–ª—å',s.goal],[],['–ó–∞–ø–∏—Å—å','–ü—Ä–µ–¥–º–µ—Ç','–î–µ–Ω—å','–ò—Å—Ç–æ—á–Ω–∏–∫','–°—É–º–º–∞']];
  s.log.slice().reverse().forEach(it=>rows.push([`${it.grade}`, it.subj||'', it.day||'', it.src||'', money(it.amount)]));
  const total=s.counts[5]*s.prices[5]+s.counts[4]*s.prices[4]+s.counts[3]*s.prices[3]+s.counts[2]*s.prices[2];
  rows.push([]); rows.push(['–ò–¢–û–ì–û','','','',money(total)]);
  const csv=rows.map(r=>r.map(c=>`"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
  const a=document.createElement('a'); 
  a.href=URL.createObjectURL(new Blob(['\ufeff'+csv],{type:'text/csv;charset=utf-8;'})); 
  a.download=`gradepay_${s.profileName||'profile'}_${s.week||'week'}.csv`; 
  a.click();
});

$('#btnExportJson')?.addEventListener('click',()=>{
  const dump={profiles:JSON.parse(JSON.stringify(profiles)),data:{}};
  profiles.forEach(p=>{
    dump.data[p.id]={};
    Object.keys(localStorage).forEach(k=>{
      const pref='gp_data_'+p.id+'_';
      if(k.startsWith(pref)){ dump.data[p.id][k.slice(pref.length)]=JSON.parse(localStorage.getItem(k)); }
    });
  });
  const a=document.createElement('a'); 
  a.href=URL.createObjectURL(new Blob([JSON.stringify(dump,null,2)],{type:'application/json'})); 
  a.download=`gradepay_backup_${new Date().toISOString().slice(0,10)}.json`; 
  a.click();
});

$('#importJson')?.addEventListener('change',async(e)=>{
  const f=e.target.files?.[0]; if(!f) return;
  try{ const obj=JSON.parse(await f.text());
    if(!obj || !Array.isArray(obj.profiles) || typeof obj.data!=='object'){ alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON —Ñ–∞–π–ª–∞'); return; }
    if(!confirm('üì• –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ? –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã.')) return;
    profiles=obj.profiles; saveProfiles(); drawProfiles();
    Object.keys(obj.data||{}).forEach(pid=>{
      const weeks=obj.data[pid]||{}; Object.keys(weeks).forEach(w=>localStorage.setItem('gp_data_'+pid+'_'+w, JSON.stringify(weeks[w])));
    });
    selectProfile(profiles[0]?.id); alert('‚úÖ –ò–º–ø–æ—Ä—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω!');
  }catch(err){ console.error(err); alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ —Ñ–∞–π–ª–∞'); }
  e.target.value='';
});

$('#btnResetWeek')?.addEventListener('click',()=>{ 
  if(confirm('üîÑ –°–±—Ä–æ—Å–∏—Ç—å —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é? –í—Å–µ –æ—Ü–µ–Ω–∫–∏ –∏ —Å—á—ë—Ç—á–∏–∫–∏ –±—É–¥—É—Ç –æ–±–Ω—É–ª–µ–Ω—ã.')){ 
    Store.clearWeek(); saveWeek(); 
    showNotification('‚úÖ –ù–µ–¥–µ–ª—è —Å–±—Ä–æ—à–µ–Ω–∞!', 'success');
  } 
});

/* ============================= –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø ============================= */

// –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
let saveTimeout;
Store.subscribe(() => {
  clearTimeout(saveTimeout);
  saveTimeout = setTimeout(saveWeek, 1000);
});

// –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –æ—Ü–µ–Ω–æ–∫
function showNotification(message, type = 'success') {
  const notification = document.createElement('div');
  notification.innerHTML = message;
  
  const colors = {
    success: 'linear-gradient(135deg, var(--success), #059669)',
    warning: 'linear-gradient(135deg, var(--warning), #d97706)',
    error: 'linear-gradient(135deg, var(--danger), #dc2626)',
    info: 'linear-gradient(135deg, var(--info), #2563eb)'
  };
  
    notification.style.cssText = `
    position: fixed; top: 100px; right: 30px; z-index: 1000;
    background: ${colors[type] || colors.success};
    color: white; padding: 20px 28px; border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg); font-weight: 600;
    animation: slideInUp 0.4s ease;
    max-width: 380px; border: 1px solid rgba(255,255,255,0.13);
    letter-spacing:0.2px; font-size: 16px;
  `;
  
  document.body.appendChild(notification);
  setTimeout(() => {
    notification.style.animation = 'slideInUp 0.4s ease reverse';
    setTimeout(() => notification.remove(), 350);
  }, 3500);
}

// –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
const originalAddEntry = addEntry;
window.addEntry = function(grade, subj='', day='', src='–≤–≤–æ–¥') {
  originalAddEntry(grade, subj, day, src);
  const gradeEmoji = grade===5?'‚≠ê':grade===4?'‚úÖ':grade===3?'‚ö†Ô∏è':'‚ùå';
  const subjText = subj ? ` –ø–æ ${subj}` : '';
  const dayText = day ? ` (${day})` : '';
  showNotification(`${gradeEmoji} –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ü–µ–Ω–∫–∞ ${grade}${subjText}${dayText}`,
                  grade >= 4 ? 'success' : grade === 3 ? 'warning' : 'error');
};

// –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
document.addEventListener('keydown', (e) => {
  // –ë—ã—Å—Ç—Ä—ã–µ –∫–ª–∞–≤–∏—à–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
  if (e.ctrlKey || e.metaKey) {
    switch(e.key) {
      case '1': e.preventDefault(); go('profiles'); break;
      case '2': e.preventDefault(); go('diary'); break;  
      case '3': e.preventDefault(); go('input'); break;
      case '4': e.preventDefault(); go('summary'); break;
      case '5': e.preventDefault(); go('guide'); break;
    }
  }
});

/* ============================= INIT ============================= */
loadProfiles();
ensureISOWeek();
renderAll(Store.get());

// –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
if (!localStorage.getItem('gp_welcome_shown')) {
  setTimeout(() => {
    showNotification('üöÄ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ GradePay! –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å —É—á–µ–Ω–∏–∫–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã.', 'info');
    localStorage.setItem('gp_welcome_shown', '1');
  }, 1200);
}

console.log('üöÄ GradePay –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
</script>
</body>
</html>
